<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi EspaÃ±ol - æˆ‘çš„è¥¿ç­ç‰™æ–‡å­¸ç¿’åŠ©æ‰‹</title>
    <style>
        :root {
            --bg: #f5f5f5;
            --card-bg: #ffffff;
            --text: #2d3436;
            --accent: #74b9ff;
            --shadow: rgba(0,0,0,0.08);
        }
        body.dark {
            --bg: #2d3436;
            --card-bg: #363e42;
            --text: #dfe6e9;
            --accent: #0984e3;
            --shadow: rgba(0,0,0,0.3);
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }
        header {
            background: var(--card-bg);
            padding: 1rem;
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        h1 {
            margin: 0;
            font-size: 1.6rem;
            text-align: center;
        }
        nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        button.tab-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
        }
        button.tab-btn.active {
            border-bottom: 3px solid var(--accent);
            color: var(--accent);
        }
        main {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .section {
            display: none;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow);
        }
        .section.active {
            display: block;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        select, input, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        button {
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        .flashcard {
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 30px auto;
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            border-radius: 12px;
            box-shadow: 0 8px 20px var(--shadow);
        }
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.8rem;
            text-align: center;
        }
        .front {
            background: #ffeaa7;
        }
        .back {
            background: #81ecec;
            transform: rotateY(180deg);
        }
        .example {
            font-size: 1rem;
            margin-top: 20px;
            opacity: 0.8;
            font-style: italic;
        }
        .status-btns {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .status-btn {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        .learning { background: #fdcb6e; }
        .review { background: #e17055; }
        .mastered { background: #00b894; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: var(--accent);
            color: white;
        }
        .note-item {
            background: var(--bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #636e72;
            font-size: 0.9rem;
        }
        #darkToggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        @media (max-width: 600px) {
            .flashcard { height: 250px; }
            .card-face { font-size: 1.5rem; }
            .controls { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Mi EspaÃ±ol</h1>
        <nav>
            <button class="tab-btn active" data-tab="flashcards">é–ƒå¡å­¸ç¿’</button>
            <button class="tab-btn" data-tab="review">è¤‡ç¿’æ¸¬é©—</button>
            <button class="tab-btn" data-tab="conjugation">å‹•è©è®ŠåŒ–</button>
            <button class="tab-btn" data-tab="dialogues">å°è©±ç·´ç¿’</button>
            <button class="tab-btn" data-tab="notes">æˆ‘çš„ç­†è¨˜</button>
            <button class="tab-btn" data-tab="importexport">åŒ¯å…¥/åŒ¯å‡º</button>
        </nav>
    </header>

    <main>
        <!-- é–ƒå¡å­¸ç¿’ -->
        <div id="flashcards" class="section active">
            <div class="controls">
                <select id="categorySelect">
                    <option value="all">å…¨éƒ¨è©å½™</option>
                    <option value="greetings">å•å€™èª</option>
                    <option value="daily">æ—¥å¸¸å°è©±</option>
                    <option value="numbers">æ•¸å­—</option>
                    <option value="colors">é¡è‰²</option>
                    <option value="family">å®¶åº­æˆå“¡</option>
                    <option value="food">é£Ÿç‰©</option>
                    <option value="travel">æ—…è¡Œç”¨èª</option>
                </select>
                <select id="modeSelect">
                    <option value="es-to-zh">è¥¿ç­ç‰™æ–‡ â†’ ä¸­æ–‡</option>
                    <option value="zh-to-es">ä¸­æ–‡ â†’ è¥¿ç­ç‰™æ–‡</option>
                </select>
                <select id="statusFilter">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="learning">é‚„åœ¨å­¸</option>
                    <option value="review">å†è¤‡ç¿’</option>
                    <option value="mastered">å·²æŒæ¡</option>
                </select>
            </div>
            <div class="flashcard" id="flashcard">
                <div class="card-inner">
                    <div class="card-face front" id="cardFront"></div>
                    <div class="card-face back" id="cardBack"></div>
                </div>
            </div>
            <div style="text-align:center;">
                <button id="prevCard">â† ä¸Šä¸€å¼µ</button>
                <button id="nextCard">ä¸‹ä¸€å¼µ â†’</button>
                <p id="progressText">ç¬¬ 1 / 1 å¼µ</p>
            </div>
            <div class="status-btns" style="justify-content:center;">
                <button class="status-btn learning" data-status="learning">é‚„åœ¨å­¸</button>
                <button class="status-btn review" data-status="review">å†è¤‡ç¿’</button>
                <button class="status-btn mastered" data-status="mastered">å·²æŒæ¡</button>
            </div>
        </div>

        <!-- è¤‡ç¿’æ¸¬é©— -->
        <div id="review" class="section">
            <h2>å¡«ç©ºè¤‡ç¿’æ¸¬é©—</h2>
            <div id="quizQuestion"></div>
            <input type="text" id="quizAnswer" placeholder="è¼¸å…¥ä½ çš„ç­”æ¡ˆ" style="width:100%;max-width:400px;margin:20px 0;">
            <button id="checkAnswer">æª¢æŸ¥ç­”æ¡ˆ</button>
            <p id="quizFeedback"></p>
            <button id="nextQuiz">ä¸‹ä¸€é¡Œ</button>
        </div>

        <!-- å‹•è©è®ŠåŒ– -->
        <div id="conjugation" class="section">
            <h2>å‹•è©ç¾åœ¨å¼è®ŠåŒ–æŸ¥è©¢</h2>
            <input type="text" id="verbInput" placeholder="è¼¸å…¥å‹•è©åŸå½¢ï¼ˆå¦‚ hablar, comer, vivirï¼‰">
            <button id="conjugateBtn">æŸ¥è©¢è®ŠåŒ–</button>
            <div id="conjugationTable"></div>
        </div>

        <!-- å°è©±ç·´ç¿’ -->
        <div id="dialogues" class="section">
            <h2>ä¸­è¥¿å°ç…§å°è©±ç·´ç¿’</h2>
            <div id="dialogueList"></div>
        </div>

        <!-- æˆ‘çš„ç­†è¨˜ -->
        <div id="notes" class="section">
            <h2>æˆ‘çš„å­¸ç¿’ç­†è¨˜</h2>
            <textarea id="newNote" placeholder="å¯«ä¸‹ä½ å­¸åˆ°çš„å–®å­—ã€å¥å­æˆ–æ–‡æ³•ç­†è¨˜..." rows="4" style="width:100%;"></textarea>
            <button id="saveNote">å„²å­˜ç­†è¨˜</button>
            <div id="notesList"></div>
        </div>

        <!-- åŒ¯å…¥åŒ¯å‡º -->
        <div id="importexport" class="section">
            <h2>è³‡æ–™åŒ¯å‡ºèˆ‡åŒ¯å…¥</h2>
            <button id="exportData">åŒ¯å‡ºæ‰€æœ‰è³‡æ–™ï¼ˆJSONï¼‰</button>
            <br><br>
            <input type="file" id="importFile" accept=".json">
            <button id="importData">åŒ¯å…¥è³‡æ–™</button>
            <p style="font-size:0.9rem;margin-top:20px;">åŒ¯å‡ºå¾Œå¯å‚™ä»½åˆ°é›²ç«¯æˆ–è½‰ç§»åˆ°å…¶ä»–è£ç½®</p>
        </div>
    </main>

    <div id="darkToggle">ğŸŒ™</div>

    <footer>
        Mi EspaÃ±ol - ä½ çš„å°ˆå±¬è¥¿ç­ç‰™æ–‡å­¸ç¿’å¤¥ä¼´ | æ‰€æœ‰è³‡æ–™å„²å­˜åœ¨æœ¬æ©Ÿç€è¦½å™¨
    </footer>

    <script>
        // åˆå§‹è©å½™åº«ï¼ˆåˆç´šï¼‰
        const initialVocabulary = [
            // å•å€™èª
            { es: "Hola", zh: "ä½ å¥½", category: "greetings", example: "Hola, Â¿cÃ³mo estÃ¡s?" },
            { es: "Buenos dÃ­as", zh: "æ—©å®‰", category: "greetings", example: "Buenos dÃ­as, seÃ±or." },
            { es: "Buenas tardes", zh: "åˆå®‰", category: "greetings" },
            { es: "Buenas noches", zh: "æ™šå®‰", category: "greetings" },
            { es: "AdiÃ³s", zh: "å†è¦‹", category: "greetings" },
            { es: "Â¿CÃ³mo estÃ¡s?", zh: "ä½ å¥½å—ï¼Ÿ", category: "greetings" },
            { es: "Bien, gracias", zh: "å¾ˆå¥½ï¼Œè¬è¬", category: "greetings" },
            { es: "Â¿Y tÃº?", zh: "ä½ å‘¢ï¼Ÿ", category: "greetings" },

            // æ—¥å¸¸å°è©±
            { es: "Por favor", zh: "è«‹", category: "daily" },
            { es: "Gracias", zh: "è¬è¬", category: "daily" },
            { es: "De nada", zh: "ä¸å®¢æ°£", category: "daily" },
            { es: "Lo siento", zh: "å°ä¸èµ·", category: "daily" },
            { es: "SÃ­", zh: "æ˜¯", category: "daily" },
            { es: "No", zh: "ä¸", category: "daily" },
            { es: "Me llamo...", zh: "æˆ‘å«...", category: "daily" },
            { es: "Â¿CÃ³mo te llamas?", zh: "ä½ å«ä»€éº¼åå­—ï¼Ÿ", category: "daily" },

            // æ•¸å­— 1-10
            { es: "uno", zh: "ä¸€", category: "numbers" },
            { es: "dos", zh: "äºŒ", category: "numbers" },
            { es: "tres", zh: "ä¸‰", category: "numbers" },
            { es: "cuatro", zh: "å››", category: "numbers" },
            { es: "cinco", zh: "äº”", category: "numbers" },
            { es: "seis", zh: "å…­", category: "numbers" },
            { es: "siete", zh: "ä¸ƒ", category: "numbers" },
            { es: "ocho", zh: "å…«", category: "numbers" },
            { es: "nueve", zh: "ä¹", category: "numbers" },
            { es: "diez", zh: "å", category: "numbers" },

            // é¡è‰²
            { es: "rojo", zh: "ç´…è‰²", category: "colors" },
            { es: "azul", zh: "è—è‰²", category: "colors" },
            { es: "verde", zh: "ç¶ è‰²", category: "colors" },
            { es: "amarillo", zh: "é»ƒè‰²", category: "colors" },
            { es: "negro", zh: "é»‘è‰²", category: "colors" },
            { es: "blanco", zh: "ç™½è‰²", category: "colors" },

            // å®¶åº­æˆå“¡
            { es: "padre", zh: "çˆ¸çˆ¸", category: "family" },
            { es: "madre", zh: "åª½åª½", category: "family" },
            { es: "hermano", zh: "å“¥å“¥/å¼Ÿå¼Ÿ", category: "family" },
            { es: "hermana", zh: "å§å§/å¦¹å¦¹", category: "family" },
            { es: "abuelo", zh: "çˆºçˆº", category: "family" },
            { es: "abuela", zh: "å¥¶å¥¶", category: "family" },

            // é£Ÿç‰©
            { es: "agua", zh: "æ°´", category: "food" },
            { es: "pan", zh: "éºµåŒ…", category: "food" },
            { es: "leche", zh: "ç‰›å¥¶", category: "food" },
            { es: "arroz", zh: "ç±³é£¯", category: "food" },
            { es: "carne", zh: "è‚‰", category: "food" },
            { es: "fruta", zh: "æ°´æœ", category: "food" },

            // æ—…è¡Œç”¨èª
            { es: "Â¿DÃ³nde estÃ¡...?", zh: "...åœ¨å“ªè£¡ï¼Ÿ", category: "travel" },
            { es: "el baÃ±o", zh: "å»æ‰€", category: "travel" },
            { es: "la estaciÃ³n", zh: "è»Šç«™", category: "travel" },
            { es: "el hotel", zh: "é£¯åº—", category: "travel" },
            { es: "la playa", zh: "æµ·ç˜", category: "travel" },
            { es: "Â¿CuÃ¡nto cuesta?", zh: "å¤šå°‘éŒ¢ï¼Ÿ", category: "travel" },
        ];

        // å°è©±ç·´ç¿’
        const dialogues = [
            {
                title: "åœ¨å’–å•¡å»³é»é¤",
                content: [
                    { es: "Buenos dÃ­as. Â¿QuÃ© desea?", zh: "æ—©å®‰ï¼Œæ‚¨è¦é»ä»€éº¼ï¼Ÿ" },
                    { es: "Un cafÃ© con leche, por favor.", zh: "ä¸€æ¯æ‹¿éµï¼Œè¬è¬ã€‚" },
                    { es: "Â¿Algo mÃ¡s?", zh: "é‚„è¦åˆ¥çš„å—ï¼Ÿ" },
                    { es: "No, gracias. Â¿CuÃ¡nto es?", zh: "ä¸è¦äº†ï¼Œè¬è¬ã€‚å¤šå°‘éŒ¢ï¼Ÿ" },
                    { es: "Son cuatro euros.", zh: "å››æ­å…ƒã€‚" },
                    { es: "AquÃ­ tiene. Gracias.", zh: "çµ¦æ‚¨ï¼Œè¬è¬ã€‚" }
                ]
            },
            {
                title: "è‡ªæˆ‘ä»‹ç´¹",
                content: [
                    { es: "Hola, me llamo Ana.", zh: "ä½ å¥½ï¼Œæˆ‘å«Anaã€‚" },
                    { es: "Encantado, soy Pablo. Â¿De dÃ³nde eres?", zh: "å¾ˆé«˜èˆˆèªè­˜ä½ ï¼Œæˆ‘æ˜¯Pabloã€‚ä½ å¾å“ªè£¡ä¾†ï¼Ÿ" },
                    { es: "Soy de TaiwÃ¡n.", zh: "æˆ‘ä¾†è‡ªå°ç£ã€‚" },
                    { es: "Â¡QuÃ© interesante! Bienvenido.", zh: "çœŸæœ‰è¶£ï¼æ­¡è¿ã€‚" }
                ]
            }
        ];

        // ä¸»è¦è³‡æ–™å„²å­˜
        let vocabulary = [];
        let notes = [];
        let currentCardIndex = 0;
        let filteredCards = [];

        // åˆå§‹åŒ–
        function init() {
            // è¼‰å…¥è³‡æ–™
            const savedVocab = localStorage.getItem('espanolVocabulary');
            const savedNotes = localStorage.getItem('espanolNotes');
            const savedDark = localStorage.getItem('espanolDarkMode');

            vocabulary = savedVocab ? JSON.parse(savedVocab) : initialVocabulary.map(item => ({
                ...item,
                status: 'learning',
                correct: 0,
                attempts: 0
            }));
            notes = savedNotes ? JSON.parse(savedNotes) : [];

            if (savedDark === 'true') {
                document.body.classList.add('dark');
            }

            setupEventListeners();
            switchTab('flashcards');
            renderDialogues();
            renderNotes();
        }

        function setupEventListeners() {
            // åˆ‡æ›é ç±¤
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelector('.tab-btn.active').classList.remove('active');
                    btn.classList.add('active');
                    switchTab(btn.dataset.tab);
                });
            });

            // æ·±è‰²æ¨¡å¼
            document.getElementById('darkToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark');
                localStorage.setItem('espanolDarkMode', document.body.classList.contains('dark'));
                document.getElementById('darkToggle').textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
            });

            // é–ƒå¡ç›¸é—œ
            const card = document.querySelector('.card-inner');
            card.addEventListener('click', () => card.classList.toggle('flipped'));

            document.getElementById('prevCard').addEventListener('click', prevCard);
            document.getElementById('nextCard').addEventListener('click', nextCard);

            document.getElementById('categorySelect').addEventListener('change', filterCards);
            document.getElementById('modeSelect').addEventListener('change', updateCurrentCard);
            document.getElementById('statusFilter').addEventListener('change', filterCards);

            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (filteredCards.length === 0) return;
                    const card = filteredCards[currentCardIndex];
                    card.status = btn.dataset.status;
                    saveVocabulary();
                    updateProgress();
                    nextCard();
                });
            });

            // å‹•è©è®ŠåŒ–
            document.getElementById('conjugateBtn').addEventListener('click', conjugateVerb);

            // æ¸¬é©—
            document.getElementById('checkAnswer').addEventListener('click', checkQuiz);
            document.getElementById('nextQuiz').addEventListener('click', generateQuiz);

            // ç­†è¨˜
            document.getElementById('saveNote').addEventListener('click', saveNote);

            // åŒ¯å‡ºåŒ¯å…¥
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importData);
        }

        function switchTab(tab) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(tab).classList.add('active');

            if (tab === 'flashcards') filterCards();
            if (tab === 'review') generateQuiz();
        }

        function filterCards() {
            const category = document.getElementById('categorySelect').value;
            const status = document.getElementById('statusFilter').value;

            filteredCards = vocabulary.filter(card => {
                if (category !== 'all' && card.category !== category) return false;
                if (status !== 'all' && card.status !== status) return false;
                return true;
            });

            currentCardIndex = 0;
            updateCurrentCard();
            updateProgress();
        }

        function updateCurrentCard() {
            if (filteredCards.length === 0) {
                document.getElementById('cardFront').innerHTML = '<p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å–®å­—</p>';
                document.getElementById('cardBack').innerHTML = '';
                document.getElementById('progressText').textContent = '0 / 0';
                return;
            }

            const card = filteredCards[currentCardIndex];
            const mode = document.getElementById('modeSelect').value;
            const front = mode === 'es-to-zh' ? card.es : card.zh;
            const back = mode === 'es-to-zh' ? card.zh : card.es;

            document.getElementById('cardFront').innerHTML = `
                <div>${front}</div>
                ${card.example ? `<div class="example">${card.example}</div>` : ''}
            `;
            document.getElementById('cardBack').innerHTML = `
                <div>${back}</div>
                <div style="font-size:0.8rem;margin-top:20px;">
                    æ­£ç¢ºç‡: ${card.attempts > 0 ? Math.round(card.correct / card.attempts * 100) : 0}%
                </div>
            `;

            document.querySelector('.card-inner').classList.remove('flipped');
            updateProgress();
        }

        function updateProgress() {
            document.getElementById('progressText').textContent = 
                `ç¬¬ ${currentCardIndex + 1} / ${filteredCards.length} å¼µ`;
        }

        function prevCard() {
            if (filteredCards.length === 0) return;
            currentCardIndex = (currentCardIndex - 1 + filteredCards.length) % filteredCards.length;
            updateCurrentCard();
        }

        function nextCard() {
            if (filteredCards.length === 0) return;
            currentCardIndex = (currentCardIndex + 1) % filteredCards.length;
            updateCurrentCard();
        }

        function saveVocabulary() {
            localStorage.setItem('espanolVocabulary', JSON.stringify(vocabulary));
        }

        // å‹•è©è®ŠåŒ–è¦å‰‡ï¼ˆè¦å‰‡å‹•è©ï¼‰
        function conjugateVerb() {
            const verb = document.getElementById('verbInput').value.trim().toLowerCase();
            if (!verb) return;

            let root, ending;
            if (verb.endsWith('ar')) {
                root = verb.slice(0, -2);
                ending = 'ar';
            } else if (verb.endsWith('er')) {
                root = verb.slice(0, -2);
                ending = 'er';
            } else if (verb.endsWith('ir')) {
                root = verb.slice(0, -2);
                ending = 'ir';
            } else {
                document.getElementById('conjugationTable').innerHTML = '<p>è«‹è¼¸å…¥è¦å‰‡å‹•è©åŸå½¢ï¼ˆ-ar, -er, -irï¼‰</p>';
                return;
            }

            const conjugations = ending === 'ar' ? 
                ['o', 'as', 'a', 'amos', 'Ã¡is', 'an'] :
                ['o', 'es', 'e', 'emos', 'Ã©is', 'en'];

            const pronouns = ['yo', 'tÃº', 'Ã©l/ella/usted', 'nosotros', 'vosotros', 'ellos/ellas/ustedes'];

            let table = '<table><tr><th>äººç¨±</th><th>' + verb + ' (ç¾åœ¨å¼)</th></tr>';
            pronouns.forEach((pronoun, i) => {
                table += `<tr><td>${pronoun}</td><td>${root}${conjugations[i]}</td></tr>`;
            });
            table += '</table>';

            document.getElementById('conjugationTable').innerHTML = table;
        }

        // æ¸¬é©—
        function generateQuiz() {
            const reviewCards = vocabulary.filter(c => c.status === 'review' || c.status === 'learning');
            if (reviewCards.length === 0) {
                document.getElementById('quizQuestion').textContent = 'æ²’æœ‰éœ€è¦è¤‡ç¿’çš„å–®å­—ï¼ç¹¼çºŒå­¸ç¿’æ–°å–®å­—å§ï½';
                return;
            }

            const card = reviewCards[Math.floor(Math.random() * reviewCards.length)];
            const sentence = card.example || `${card.es} çš„æ„æ€æ˜¯ä»€éº¼ï¼Ÿ`;
            document.getElementById('quizQuestion').innerHTML = 
                sentence.replace(card.es, '_____') + '<br><br>è«‹å¡«å…¥æ­£ç¢ºçš„è¥¿ç­ç‰™æ–‡ï¼š';

            window.currentQuizCard = card;
            document.getElementById('quizAnswer').value = '';
            document.getElementById('quizFeedback').textContent = '';
        }

        function checkQuiz() {
            const answer = document.getElementById('quizAnswer').value.trim().toLowerCase();
            const card = window.currentQuizCard;
            if (!card) return;

            card.attempts++;
            if (answer === card.es.toLowerCase()) {
                card.correct++;
                document.getElementById('quizFeedback').innerHTML = '<strong style="color:green;">æ­£ç¢ºï¼ğŸ‘</strong>';
                if (card.correct / card.attempts >= 0.8) {
                    card.status = 'mastered';
                }
            } else {
                document.getElementById('quizFeedback').innerHTML = 
                    `<strong style="color:red;">ä¸æ­£ç¢ºï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${card.es}</strong>`;
                card.status = 'review';
            }
            saveVocabulary();
        }

        // å°è©±ç·´ç¿’
        function renderDialogues() {
            const container = document.getElementById('dialogueList');
            container.innerHTML = dialogues.map(d => `
                <div style="margin-bottom:30px;">
                    <h3>${d.title}</h3>
                    <table>
                        ${d.content.map(line => 
                            `<tr><td><strong>${line.es}</strong></td><td>${line.zh}</td></tr>`
                        ).join('')}
                    </table>
                </div>
            `).join('');
        }

        // ç­†è¨˜
        function saveNote() {
            const content = document.getElementById('newNote').value.trim();
            if (!content) return;

            notes.unshift({
                content,
                date: new Date().toLocaleDateString('zh-TW')
            });
            localStorage.setItem('espanolNotes', JSON.stringify(notes));
            document.getElementById('newNote').value = '';
            renderNotes();
        }

        function renderNotes() {
            const list = document.getElementById('notesList');
            if (notes.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:#aaa;">é‚„æ²’æœ‰ç­†è¨˜ï¼Œé–‹å§‹è¨˜éŒ„å§ï¼</p>';
                return;
            }
            list.innerHTML = notes.map(note => `
                <div class="note-item">
                    <div>${note.content.replace(/\n/g, '<br>')}</div>
                    <small style="color:#aaa;">${note.date}</small>
                </div>
            `).join('');
        }

        // åŒ¯å‡ºåŒ¯å…¥
        function exportData() {
            const data = {
                vocabulary,
                notes,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mi-espanol-backup.json';
            a.click();
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.vocabulary) {
                        vocabulary = data.vocabulary;
                        saveVocabulary();
                    }
                    if (data.notes) {
                        notes = data.notes;
                        localStorage.setItem('espanolNotes', JSON.stringify(notes));
                        renderNotes();
                    }
                    alert('è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
                    filterCards();
                } catch (err) {
                    alert('åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤');
                }
            };
            reader.readAsText(file);
        }

        // å•Ÿå‹•
        init();
    </script>
</body>
</html>
